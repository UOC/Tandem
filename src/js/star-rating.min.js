/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version 3.0.0
 *
 * A simple yet powerful JQuery star rating plugin that allows rendering
 * fractional star ratings and supports Right to Left (RTL) input.
 * 
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){var a=0,t=5,n=.5,r=function(a,t){return"undefined"==typeof a||null===a||void 0===a||a==[]||""===a||t&&""===e.trim(a)},l=function(e,a,t){var n=r(e.data(a))?e.attr(a):e.data(a);return n?n:t[a]},i=function(e){var a=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return a?Math.max(0,(a[1]?a[1].length:0)-(a[2]?+a[2]:0)):0},s=function(e,a){return parseFloat(e.toFixed(a))},o=function(a,t){this.$element=e(a),this.init(t)};o.prototype={constructor:o,_parseAttr:function(e,i){var s=this,o=s.$element;if("range"===o.attr("type")||"number"===o.attr("type")){var c=l(o,e,i),p=n;"min"===e?p=a:"max"===e?p=t:"step"===e&&(p=n);var u=r(c)?p:c;return parseFloat(u)}return parseFloat(i[e])},listen:function(){var a=this;a.$rating.on("click",function(e){if(!a.inactive){var t=e.pageX-a.$rating.offset().left;a.setStars(t),a.$element.trigger("change"),a.$element.trigger("rating.change",[a.$element.val(),a.$caption.html()]),a.starClicked=!0}}),a.$rating.on("mousemove",function(e){if(a.hoverEnabled&&!a.inactive){a.starClicked=!1;var t=e.pageX-a.$rating.offset().left,n=a.calculate(t);a.toggleHover(n),a.$element.trigger("rating.hover",[n.val,n.caption,"stars"])}}),a.$rating.on("mouseleave",function(){if(a.hoverEnabled&&!a.inactive&&!a.starClicked){var e=a.cache;a.toggleHover(e),a.$element.trigger("rating.hoverleave",["stars"])}}),a.$clear.on("mousemove",function(){if(a.hoverEnabled&&!a.inactive&&a.hoverOnClear){a.clearClicked=!1;var e,t='<span class="'+a.clearCaptionClass+'">'+a.clearCaption+"</span>",n=a.clearValue,r=a.getWidthFromValue(n);e={caption:t,width:r,val:n},a.toggleHover(e),a.$element.trigger("rating.hover",[n,t,"clear"])}}),a.$clear.on("mouseleave",function(){if(a.hoverEnabled&&!a.inactive&&!a.clearClicked&&a.hoverOnClear){var e=a.cache;a.toggleHover(e),a.$element.trigger("rating.hoverleave",["clear"])}}),a.$clear.on("click",function(){a.inactive||(a.clear(),a.clearClicked=!0)}),e(a.$element[0].form).on("reset",function(){a.inactive||a.reset()})},initSlider:function(e){var l=this;r(l.$element.val())&&l.$element.val(0),l.initialValue=l.$element.val(),l.min="undefined"!=typeof e.min?e.min:l._parseAttr("min",e),l.max="undefined"!=typeof e.max?e.max:l._parseAttr("max",e),l.step="undefined"!=typeof e.step?e.step:l._parseAttr("step",e),(isNaN(l.min)||r(l.min))&&(l.min=a),(isNaN(l.max)||r(l.max))&&(l.max=t),(isNaN(l.step)||r(l.step)||0==l.step)&&(l.step=n),l.diff=l.max-l.min},init:function(a){var t=this;t.options=a,t.hoverEnabled=a.hoverEnabled,t.hoverChangeCaption=a.hoverChangeCaption,t.hoverChangeStars=a.hoverChangeStars,t.hoverOnClear=a.hoverOnClear,t.starClicked=!1,t.clearClicked=!1,t.initSlider(a),t.checkDisabled(),$element=t.$element,t.containerClass=a.containerClass,t.glyphicon=a.glyphicon;var n=t.glyphicon?"":"★";t.symbol=r(a.symbol)?n:a.symbol,t.rtl=a.rtl||t.$element.attr("dir"),t.rtl&&t.$element.attr("dir","rtl"),t.showClear=a.showClear,t.showCaption=a.showCaption,t.size=a.size,t.stars=a.stars,t.defaultCaption=a.defaultCaption,t.starCaptions=a.starCaptions,t.starCaptionClasses=a.starCaptionClasses,t.clearButton=a.clearButton,t.clearButtonTitle=a.clearButtonTitle,t.clearButtonBaseClass=r(a.clearButtonBaseClass)?"clear-rating":a.clearButtonBaseClass,t.clearButtonActiveClass=r(a.clearButtonActiveClass)?"clear-rating-active":a.clearButtonActiveClass,t.clearCaption=a.clearCaption,t.clearCaptionClass=a.clearCaptionClass,t.clearValue=r(a.clearValue)?t.min:a.clearValue,t.$element.removeClass("form-control").addClass("form-control"),t.$clearElement=r(a.clearElement)?null:e(a.clearElement),t.$captionElement=r(a.captionElement)?null:e(a.captionElement),"undefined"==typeof t.$rating&&"undefined"==typeof t.$container&&(t.$rating=e(document.createElement("div")).html('<div class="rating-stars"></div>'),t.$container=e(document.createElement("div")),t.$container.before(t.$rating),t.$container.append(t.$rating),t.$element.before(t.$container).appendTo(t.$rating)),t.$stars=t.$rating.find(".rating-stars"),t.generateRating(),t.$clear=r(t.$clearElement)?t.$container.find("."+t.clearButtonBaseClass):t.$clearElement,t.$caption=r(t.$captionElement)?t.$container.find(".caption"):t.$captionElement,t.setStars(),t.$element.hide(),t.listen(),t.showClear&&t.$clear.attr({"class":t.getClearClass()}),t.cache={caption:t.$caption.html(),width:t.$stars.width(),val:t.$element.val()},t.$element.removeClass("rating-loading")},checkDisabled:function(){var e=this;e.disabled=l(e.$element,"disabled",e.options),e.readonly=l(e.$element,"readonly",e.options),e.inactive=e.disabled||e.readonly},getClearClass:function(){return this.clearButtonBaseClass+" "+(this.inactive?"":this.clearButtonActiveClass)},generateRating:function(){var e=this,a=e.renderClear(),t=e.renderCaption(),n=e.rtl?"rating-container-rtl":"rating-container",l=e.getStars();n+=e.glyphicon?""==e.symbol?" rating-gly-star":" rating-gly":" rating-uni",e.$rating.attr("class",n),e.$rating.attr("data-content",l),e.$stars.attr("data-content",l);var n=e.rtl?"star-rating-rtl":"star-rating";e.$container.attr("class",n+" rating-"+e.size),e.inactive?e.$container.removeClass("rating-active").addClass("rating-disabled"):e.$container.removeClass("rating-disabled").addClass("rating-active"),"undefined"==typeof e.$caption&&"undefined"==typeof e.$clear&&(e.rtl?e.$container.prepend(t).append(a):e.$container.prepend(a).append(t)),r(e.containerClass)||e.$container.removeClass(e.containerClass).addClass(e.containerClass)},getStars:function(){for(var e=this,a=e.stars,t="",n=1;a>=n;n++)t+=e.symbol;return t},renderClear:function(){var e=this;if(!e.showClear)return"";var a=e.getClearClass();return r(e.$clearElement)?'<div class="'+a+'" title="'+e.clearButtonTitle+'">'+e.clearButton+"</div>":(e.$clearElement.removeClass(a).addClass(a).attr({title:e.clearButtonTitle}),e.$clearElement.html(e.clearButton),"")},renderCaption:function(){var e=this,a=e.$element.val();if(!e.showCaption)return"";var t=e.fetchCaption(a);return r(e.$captionElement)?'<div class="caption">'+t+"</div>":(e.$captionElement.removeClass("caption").addClass("caption").attr({title:e.clearCaption}),e.$captionElement.html(t),"")},fetchCaption:function(e){var a,t,n=this,l=parseFloat(e);if(a="function"==typeof n.starCaptionClasses?r(n.starCaptionClasses(l))?n.clearCaptionClass:n.starCaptionClasses(l):r(n.starCaptionClasses[l])?n.clearCaptionClass:n.starCaptionClasses[l],"function"==typeof n.starCaptions)var t=r(n.starCaptions(l))?n.defaultCaption.replace(/\{rating\}/g,l):n.starCaptions(l);else var t=r(n.starCaptions[l])?n.defaultCaption.replace(/\{rating\}/g,l):n.starCaptions[l];var i=l==n.clearValue?n.clearCaption:t;return'<span class="'+a+'">'+i+"</span>"},getWidthFromValue:function(e){{var a=this,t=a.min,n=a.max;a.step}return t>=e||t==n?0:e>=n?100:100*(e-t)/(n-t)},getValueFromPosition:function(e){var a,t,n=this,r=i(n.step),l=n.$rating.width();return a=e/l,t=n.rtl?n.min+Math.floor(n.diff*a/n.step)*n.step:n.min+Math.ceil(n.diff*a/n.step)*n.step,t<n.min?t=n.min:t>n.max&&(t=n.max),t=s(parseFloat(t),r),n.rtl&&(t=n.max-t),t},toggleHover:function(e){var a=this;if(a.hoverChangeCaption){var t=e.val<=a.clearValue?a.fetchCaption(a.clearValue):e.caption;a.$caption.html(t)}if(a.hoverChangeStars){var n=a.getWidthFromValue(a.clearValue),r=e.val<=a.clearValue?a.rtl?100-n+"%":n+"%":e.width;a.$stars.css("width",r)}},calculate:function(e){var a=this,t=r(a.$element.val())?0:a.$element.val(),n=arguments.length?a.getValueFromPosition(e):t,l=a.fetchCaption(n),i=a.getWidthFromValue(n);return a.rtl&&(i=100-i),i+="%",{caption:l,width:i,val:n}},setStars:function(e){var a=this,t=arguments.length?a.calculate(e):a.calculate();a.$element.val(t.val),a.$stars.css("width",t.width),a.$caption.html(t.caption),a.cache=t},clear:function(){var e=this,a='<span class="'+e.clearCaptionClass+'">'+e.clearCaption+"</span>";e.$stars.removeClass("rated"),e.inactive||e.$caption.html(a),e.$element.val(e.clearValue),e.setStars(),e.$element.trigger("rating.clear")},reset:function(){var e=this;e.$element.val(e.initialValue),e.setStars(),e.$element.trigger("rating.reset")},update:function(e){if(arguments.length>0){var a=this;a.$element.val(e),a.setStars()}},refresh:function(a){var t=this;if(arguments.length){t.init(e.extend(t.options,a)),t.showClear?t.$clear.show():t.$clear.hide(),t.showCaption?t.$caption.show():t.$caption.hide()}}},e.fn.rating=function(a){var t=Array.apply(null,arguments);return t.shift(),this.each(function(){var n=e(this),r=n.data("rating"),l="object"==typeof a&&a;r||n.data("rating",r=new o(this,e.extend({},e.fn.rating.defaults,l,e(this).data()))),"string"==typeof a&&r[a].apply(r,t)})},e.fn.rating.defaults={stars:5,glyphicon:!0,symbol:null,disabled:!1,readonly:!1,rtl:!1,size:"md",showClear:!0,showCaption:!0,defaultCaption:"{rating} Stars",starCaptions:{.5:"Half Star",1:"One Star",1.5:"One & Half Star",2:"Two Stars",2.5:"Two & Half Stars",3:"Three Stars",3.5:"Three & Half Stars",4:"Four Stars",4.5:"Four & Half Stars",5:"Five Stars"},starCaptionClasses:{.5:"label label-danger",1:"label label-danger",1.5:"label label-warning",2:"label label-warning",2.5:"label label-info",3:"label label-info",3.5:"label label-primary",4:"label label-primary",4.5:"label label-success",5:"label label-success"},clearButton:'<i class="glyphicon glyphicon-minus-sign"></i>',clearButtonTitle:"Clear",clearButtonBaseClass:"clear-rating",clearButtonActiveClass:"clear-rating-active",clearCaption:"Not Rated",clearCaptionClass:"label label-default",clearValue:null,captionElement:null,clearElement:null,containerClass:null,hoverEnabled:!0,hoverChangeCaption:!0,hoverChangeStars:!0,hoverOnClear:!0},e("input.rating").addClass("rating-loading"),e(document).ready(function(){var a=e("input.rating"),t=Object.keys(a).length;t>0&&a.rating()})}(jQuery);